import React, { useState } from 'react';
import { generateClient } from 'aws-amplify/api';
import * as mutations from './graphql/mutations';
import * as queries from './graphql/queries';

const client = generateClient();

const itineraryData = [
  // 8æœˆ12æ—¥ï¼ˆæœˆï¼‰
  { startTime: "2025-08-12T21:30:00", title: "è¥¿èˆ¹æ©‹é§…å—å£ é«˜é€Ÿãƒã‚¹ä¹—ã‚Šå ´ é›†åˆ", points: "ãƒˆã‚¤ãƒ¬ã‚’æ¸ˆã¾ã›ã€é£²ã¿ç‰©ãªã©ã‚’æº–å‚™ã€‚ãƒã‚¹ã¯å®šåˆ»ã«å‡ºç™ºã—ã¾ã™ã€‚æ—©ã‚ã®è¡Œå‹•ã‚’å¿ƒãŒã‘ã¾ã—ã‚‡ã†ã€‚" },
  { startTime: "2025-08-12T22:10:00", title: "å¤œè¡Œãƒã‚¹ä¹—è»Šãƒ»å¤§é˜ªã¸å‡ºç™ºï¼", points: "å¤§é˜ªã§ã®å¤§å†’é™ºã‚’å¤¢è¦‹ã¦ã€ãŠã‚„ã™ã¿ãªã•ã„ã€‚ãƒªãƒ©ãƒƒã‚¯ã‚¹ã§ãã‚‹æœè£…ãŒãŠã™ã™ã‚ã§ã™ã€‚" },
  
  // 8æœˆ13æ—¥ï¼ˆç«ï¼‰è©³ç´°ç‰ˆ - UCWå®Œå…¨æ”»ç•¥ãƒ—ãƒ©ãƒ³
  { startTime: "2025-08-13T08:50:00", title: "å¤§é˜ªä¸‡åš è¥¿ã‚²ãƒ¼ãƒˆå‰ åˆ°ç€", points: "ãƒã‚¹ã‚’é™ã‚ŠãŸã‚‰ã€ã¾ãšãƒˆã‚¤ãƒ¬ã®å ´æ‰€ã‚’ç¢ºèªã€‚å¤¢ã«è¦‹ãŸä¸‡åšä¼šå ´ã¯ã‚‚ã†ç›®ã®å‰ï¼" },
  { startTime: "2025-08-13T09:00:00", title: "ã‚·ãƒ£ãƒˆãƒ«ãƒã‚¹ã§JRæ¡œå³¶é§…ã¸", points: "è¥¿ã‚²ãƒ¼ãƒˆå‰ã®ãƒã‚¹ãƒ­ãƒ¼ã‚¿ãƒªãƒ¼ã‹ã‚‰ä¹—è»Šã€‚ç´„15åˆ†ã®ãƒã‚¹æ—…ã§ã™ã€‚" },
  { startTime: "2025-08-13T09:15:00", title: "JRã‚†ã‚å’²ç·šã§ãƒ¦ãƒ‹ãƒãƒ¼ã‚µãƒ«ã‚·ãƒ†ã‚£é§…ã¸", points: "æ¡œå³¶é§…ã‹ã‚‰ä¸€é§…ã ã‘é›»è»Šã«ä¹—ã‚Šã¾ã™ã€‚ã™ãã«åˆ°ç€ï¼" },
  { startTime: "2025-08-13T09:25:00", title: "ãƒãƒƒãƒ—ã‚³ãƒ¼ãƒ³ãƒ‘ãƒ‘ã§ç‰¹åˆ¥ãªæœé£Ÿã‚’ï¼", points: "32ç¨®é¡ã®å‘³ã‹ã‚‰ãŠæ°—ã«å…¥ã‚Šã‚’é¸ã³ã¾ã—ã‚‡ã†ï¼ã“ã“ã‹ã‚‰æ°—åˆ†ã¯æœ€é«˜æ½®ï¼" },
  { startTime: "2025-08-13T10:00:00", title: "UCWã‚’æ•£ç­–ï¼†æ—©ã‚ã®ãƒ©ãƒ³ãƒ", points: "ã‚«ãƒ©ãƒ•ãƒ«ãªã‚·ãƒ§ãƒƒãƒ—ã‚’çœºã‚ãŸã‚Šã€å¤§é˜ªåç‰©ãŸã“ç„¼ãã®é£Ÿã¹æ¯”ã¹ã‚’ã—ãŸã‚Šã€‚11æ™‚é–‹åº—ã®ã€ŒTAKOPAã€ãŒç‹™ã„ç›®ã§ã™ã€‚" },
  { startTime: "2025-08-13T11:45:00", title: "ä¸‡åšä¼šå ´ã¸å¸°é‚„ï¼", points: "å†ã³JRã¨ã‚·ãƒ£ãƒˆãƒ«ãƒã‚¹ã‚’ä¹—ã‚Šç¶™ãã€æ±ºæˆ¦ã®åœ°ãƒ»è¥¿ã‚²ãƒ¼ãƒˆã¸ã€‚ã„ã‚ˆã„ã‚ˆå…¥å ´ã§ã™ï¼" },
  
  // ä¸‡åšä¼šå ´å†…
  { startTime: "2025-08-13T12:00:00", title: "ã€æœ€é‡è¦ã€‘å…¥å ´ï¼†å½“æ—¥äºˆç´„é›»æ’ƒä½œæˆ¦ï¼", points: "å…¥å ´ã‚²ãƒ¼ãƒˆã‚’é€šéã—ãªãŒã‚‰ã€ã‚¹ãƒãƒ›ã§ã‚¬ãƒ³ãƒ€ãƒ ãƒ‘ãƒ“ãƒªã‚ªãƒ³(12æ™‚æ )ã®å½“æ—¥ç™»éŒ²ã«æŒ‘æˆ¦ï¼å–ã‚Œã‚Œã°æœ€é«˜ã€å–ã‚Œãªãã¦ã‚‚å…¨ãå•é¡Œãªã—ï¼" },
  { startTime: "2025-08-13T12:30:00", title: "æ¡ˆå†…æ‰€ã§æƒ…å ±åé›†ï¼†ä½œæˆ¦ä¼šè­°", points: "ã¾ãšã¯æ¡ˆå†…æ‰€ã¸ã€‚ã€Œå­ã©ã‚‚ãŒæ¥½ã—ã‚ã‚‹ã€ä»Šä¸€ç•ªç©ºã„ã¦ã„ã‚‹ãƒ‘ãƒ“ãƒªã‚ªãƒ³ã¯ï¼Ÿã€ã¨èãã¾ã—ã‚‡ã†ï¼ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æƒ…å ±ã‚’ã‚²ãƒƒãƒˆï¼" },
  { startTime: "2025-08-13T13:00:00", title: "ã€ä¸–ç•Œæ—…è¡Œã¸å‡ºç™ºï¼ã€‘äºˆç´„ä¸è¦ãƒ‘ãƒ“ãƒªã‚ªãƒ³å·¡ã‚Š", points: "å„ªå…ˆåº¦Sï¼šğŸ‡³ğŸ‡±ã‚ªãƒ©ãƒ³ãƒ€ã€ğŸ‡¨ğŸ‡­ã‚¹ã‚¤ã‚¹ã€ğŸ‡©ğŸ‡ªãƒ‰ã‚¤ãƒ„\\nå„ªå…ˆåº¦Aï¼šğŸ‡¦ğŸ‡ªUAEã€ğŸ‡¦ğŸ‡ºã‚ªãƒ¼ã‚¹ãƒˆãƒ©ãƒªã‚¢ã€ğŸ‡ºğŸ‡¸ã‚¢ãƒ¡ãƒªã‚«\\næ¡ˆå†…æ‰€ã®æƒ…å ±ã‚’ã‚‚ã¨ã«ã€å¾…ã¡æ™‚é–“ã®å°‘ãªã„ãƒ‘ãƒ“ãƒªã‚ªãƒ³ã‹ã‚‰æ”»ç•¥ï¼" },
  { startTime: "2025-08-13T15:00:00", title: "äºˆç´„æ¸ˆã¿ãƒŸãƒ¥ãƒ¼ã‚¸ã‚«ãƒ«é‘‘è³", points: "ãƒ‘ãƒ“ãƒªã‚ªãƒ³å·¡ã‚Šã®åˆé–“ã«ã€äºˆç´„ã—ãŸã‚¹ã‚¿ãƒ³ãƒ‰å¸­ã§ç´ æ™´ã‚‰ã—ã„ã‚·ãƒ§ãƒ¼ã‚’é‘‘è³ã€‚è‰¯ã„ä¼‘æ†©ã«ã‚‚ãªã‚Šã¾ã™ã€‚" },
  { startTime: "2025-08-13T16:00:00", title: "ä¼‘æ†©ï¼†ãƒ•ãƒªãƒ¼ã‚¿ã‚¤ãƒ ", points: "äººæ··ã¿ã«ç–²ã‚ŒãŸã‚‰ã€Œé™ã‘ã•ã®æ£®ã€ã§ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³ã€‚ãŠã‚„ã¤ã‚’é£Ÿã¹ãŸã‚Šã€å±‹å¤–ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’æ¥½ã—ã‚“ã ã‚Šã—ã¾ã—ã‚‡ã†ã€‚" },
  
  // å¤œã®éƒ¨
  { startTime: "2025-08-13T19:30:00", title: "å¤œç©ºã‚’å½©ã‚‹ãƒ‰ãƒ­ãƒ¼ãƒ³ã‚·ãƒ§ãƒ¼ï¼ˆèŠ±ç«ï¼‰é‘‘è³", points: "ä¸€æ—¥ã®ç· ã‚ããã‚Šã«ã€å¤œç©ºã«æã‹ã‚Œã‚‹å…‰ã®ã‚¢ãƒ¼ãƒˆã‚’é‘‘è³ã€‚æ˜¼é–“ã¨ã¯å…¨ãé•ã†ã€å¹»æƒ³çš„ãªä¸‡åšã®å§¿ã‚’ç›®ã«ç„¼ãä»˜ã‘ã¾ã—ã‚‡ã†ã€‚æœ€é«˜ã®æ€ã„å‡ºã«ãªã‚‹ã“ã¨é–“é•ã„ãªã—ã§ã™ã€‚" },
  { startTime: "2025-08-13T21:00:00", title: "æ„Ÿå‹•ã®ãƒ•ã‚£ãƒŠãƒ¼ãƒ¬ã€æ¢…ç”°ã¸ç§»å‹•é–‹å§‹", points: "ã‚·ãƒ§ãƒ¼ã®çµ‚äº†å¾Œã€æ„Ÿå‹•ã®ä½™éŸ»ã«æµ¸ã‚ŠãªãŒã‚‰ã€é€Ÿã‚„ã‹ã«è¥¿ã‚²ãƒ¼ãƒˆã®ã‚·ãƒ£ãƒˆãƒ«ãƒã‚¹ä¹—ã‚Šå ´ã¸å‘ã‹ã„ã¾ã™ã€‚é–‰å ´é–“éš›ã¯æ··é›‘ã™ã‚‹ã®ã§ã€ãŠå­æ§˜ã¨é€¸ã‚Œãªã„ã‚ˆã†æ³¨æ„ã—ã¾ã—ã‚‡ã†ã€‚" },
  { startTime: "2025-08-13T21:20:00", title: "æ¢…ç”°ï¼ˆå¤§é˜ªé§…ï¼‰è¡Œãã‚·ãƒ£ãƒˆãƒ«ãƒã‚¹ã«ä¹—è»Š", points: "ä¹—ã‚Šæ›ãˆãªã—ã§åº§ã£ã¦å¸°ã‚Œã‚‹å¿«é©ãªãƒã‚¹ã§ã€æ¢…ç”°ã¸å‘ã‹ã„ã¾ã™ã€‚ãƒã‚¹ã®ä¸­ã§å°‘ã—ä»®çœ ã‚’ã¨ã‚‹ã®ã‚‚è‰¯ã„ã§ã—ã‚‡ã†ã€‚https://www.expo2025.or.jp/access/" },
  { startTime: "2025-08-13T22:00:00", title: "æ¢…ç”°åˆ°ç€ã€ãƒã‚¹ä¹—è»Šæº–å‚™", points: "ãƒ¨ãƒ‰ãƒã‚·æ¢…ç”°ã‚¿ãƒ¯ãƒ¼è¿‘ãã«åˆ°ç€ã€‚ãƒã‚¹ä¹—ã‚Šå ´è¿‘ãã®ã‚³ãƒ³ãƒ“ãƒ‹ã‚„ã‚«ãƒ•ã‚§ã§ã€å¸°ã‚Šã®ãƒã‚¹ã§é£²ã‚€é£²ã¿ç‰©ã®è³¼å…¥ã‚„ãƒˆã‚¤ãƒ¬ã‚’æ¸ˆã¾ã›ã¦ãŠãã¾ã—ã‚‡ã†ã€‚" },
  { startTime: "2025-08-13T22:20:00", title: "ãƒ¨ãƒ‰ãƒã‚·æ¢…ç”°ã‚¿ãƒ¯ãƒ¼å‰ãƒã‚¹ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã¸", points: "ä¹—ã‚Šé…ã‚Œãªã„ã‚ˆã†ã«ã€ä½™è£•ã‚’ã‚‚ã£ã¦ãƒã‚¹ä¹—ã‚Šå ´ã¸ç§»å‹•ã—ã¾ã™ã€‚ãŠåœŸç”£ã®æœ€çµ‚ãƒã‚§ãƒƒã‚¯ã‚‚ã“ã®æ™‚ã«ã€‚" },
  { startTime: "2025-08-13T22:30:00", title: "å¤œè¡Œãƒã‚¹ä¹—è»Šãƒ»åƒè‘‰ã¸ï¼", points: "ãŸãã•ã‚“ã®æ€ã„å‡ºã‚’èƒ¸ã«ã€å¸°è·¯ã«ã¤ãã¾ã™ã€‚ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼" },
  
  // 8æœˆ14æ—¥ï¼ˆæ°´ï¼‰
  { startTime: "2025-08-14T08:50:00", title: "è¥¿èˆ¹æ©‹é§… åˆ°ç€", points: "ç„¡äº‹åˆ°ç€ã§ã™ã€‚å®¶ã«å¸°ã‚‹ã¾ã§ãŒå†’é™ºã§ã™ã€‚æ°—ã‚’ã¤ã‘ã¦ãŠå¸°ã‚Šãã ã•ã„ï¼" }
];

export const SeedDatabaseFixed = () => {
  const [status, setStatus] = useState('å¾…æ©Ÿä¸­');
  const [isLoading, setIsLoading] = useState(false);

  const clearDatabase = async () => {
    setStatus('ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ã‚¯ãƒªã‚¢ä¸­...');
    setIsLoading(true);
    
    try {
      // æ—¢å­˜ã®ãƒ‡ãƒ¼ã‚¿ã‚’å…¨ã¦å–å¾—
      const result = await client.graphql({
        query: queries.listItineraries,
        variables: { limit: 1000 }
      }) as any;
      
      const items = result.data?.listItineraries?.items || [];
      
      // å…¨ã¦ã®ã‚¢ã‚¤ãƒ†ãƒ ã‚’å‰Šé™¤
      for (const item of items) {
        await client.graphql({
          query: mutations.deleteItinerary,
          variables: { input: { id: item.id } }
        });
      }
      
      setStatus(`${items.length}ä»¶ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚`);
    } catch (error: any) {
      console.error('Error clearing database:', error);
      setStatus(`ã‚¯ãƒªã‚¢ã‚¨ãƒ©ãƒ¼: ${error.message}`);
    } finally {
      setIsLoading(false);
    }
  };

  const seedDatabase = async () => {
    setStatus('ç™»éŒ²å‡¦ç†ã‚’é–‹å§‹ã—ã¾ã™...');
    setIsLoading(true);
    let count = 0;
    
    try {
      for (const item of itineraryData) {
        const input = {
          startTime: item.startTime,
          title: item.title,
          points: item.points,
          description: item.title,
        };
        
        await client.graphql({ 
          query: mutations.createItinerary, 
          variables: { input: input } 
        });
        
        count++;
        setStatus(`${count} / ${itineraryData.length} ä»¶ ç™»éŒ²å®Œäº†...`);
      }
      
      setStatus('ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã®ç™»éŒ²ãŒå®Œäº†ã—ã¾ã—ãŸï¼');
      
      // 3ç§’å¾Œã«ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰
      setTimeout(() => {
        window.location.reload();
      }, 3000);
      
    } catch (error: any) {
      console.error('ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¸ã®ç™»éŒ²ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ', error);
      console.error('Error details:', error.errors);
      setStatus(`ã‚¨ãƒ©ãƒ¼: ${error.message || error.errors?.[0]?.message || 'ãƒ‡ãƒ¼ã‚¿ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸ'}`);
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <div style={{ 
      padding: '20px', 
      background: 'white', 
      borderRadius: '10px', 
      margin: '20px',
      boxShadow: '0 2px 10px rgba(0,0,0,0.1)'
    }}>
      <h2>ğŸŒ æ—…è¡Œè¨ˆç”»ãƒ‡ãƒ¼ã‚¿ç™»éŒ²ãƒ„ãƒ¼ãƒ«</h2>
      <p>ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«æ—…è¡Œè¨ˆç”»ã‚’ç™»éŒ²ãƒ»ç®¡ç†ã—ã¾ã™ã€‚</p>
      
      <div style={{ display: 'flex', gap: '10px', marginTop: '10px' }}>
        <button 
          onClick={clearDatabase} 
          disabled={isLoading}
          style={{
            padding: '10px 20px',
            fontSize: '16px',
            background: isLoading ? '#ccc' : '#e74c3c',
            color: 'white',
            border: 'none',
            borderRadius: '5px',
            cursor: isLoading ? 'not-allowed' : 'pointer'
          }}
        >
          {isLoading ? 'å‡¦ç†ä¸­...' : 'ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ã‚¯ãƒªã‚¢'}
        </button>
        
        <button 
          onClick={seedDatabase} 
          disabled={isLoading}
          style={{
            padding: '10px 20px',
            fontSize: '16px',
            background: isLoading ? '#ccc' : '#667eea',
            color: 'white',
            border: 'none',
            borderRadius: '5px',
            cursor: isLoading ? 'not-allowed' : 'pointer'
          }}
        >
          {isLoading ? 'ç™»éŒ²ä¸­...' : 'æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ã‚’ç™»éŒ²'}
        </button>
      </div>
      
      <p style={{ marginTop: '15px', fontWeight: 'bold' }}>
        ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: {status}
      </p>
    </div>
  );
};