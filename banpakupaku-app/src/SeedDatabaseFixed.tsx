import React, { useState } from 'react';
import { generateClient } from 'aws-amplify/api';
import * as mutations from './graphql/mutations';
import * as queries from './graphql/queries';

const client = generateClient();

const itineraryData = [
  // 8æœˆ12æ—¥ï¼ˆæœˆï¼‰
  { startTime: "2025-08-12T21:30:00", title: "è¥¿èˆ¹æ©‹é§…å—å£ é«˜é€Ÿãƒã‚¹ä¹—ã‚Šå ´ é›†åˆ", points: "ãƒˆã‚¤ãƒ¬ã‚’æ¸ˆã¾ã›ã€é£²ã¿ç‰©ãªã©ã‚’æº–å‚™ã€‚ãƒã‚¹ã¯å®šåˆ»ã«å‡ºç™ºã—ã¾ã™ã€‚æ—©ã‚ã®è¡Œå‹•ã‚’å¿ƒãŒã‘ã¾ã—ã‚‡ã†ã€‚" },
  { startTime: "2025-08-12T22:10:00", title: "å¤œè¡Œãƒã‚¹ä¹—è»Šãƒ»å¤§é˜ªã¸å‡ºç™ºï¼", points: "å¤§é˜ªã§ã®å¤§å†’é™ºã‚’å¤¢è¦‹ã¦ã€ãŠã‚„ã™ã¿ãªã•ã„ã€‚ãƒªãƒ©ãƒƒã‚¯ã‚¹ã§ãã‚‹æœè£…ãŒãŠã™ã™ã‚ã§ã™ã€‚" },
  
  // 8æœˆ13æ—¥ï¼ˆç«ï¼‰è©³ç´°ç‰ˆ
  { startTime: "2025-08-13T08:50:00", title: "å¤§é˜ªä¸‡åš è¥¿ã‚²ãƒ¼ãƒˆå‰ åˆ°ç€", points: "å¤œè¡Œãƒã‚¹ã®é•·æ—…ã€ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼ã¾ãšã¯ãƒã‚¹ã‚’é™ã‚Šã¦å¤§ããæ·±å‘¼å¸ã€‚ãƒˆã‚¤ãƒ¬ã®å ´æ‰€ã‚’ç¢ºèªã—ã€ã“ã‚Œã‹ã‚‰ã®å†’é™ºã«å‚™ãˆã¾ã—ã‚‡ã†ã€‚" },
  { startTime: "2025-08-13T09:00:00", title: "ã‚·ãƒ£ãƒˆãƒ«ãƒã‚¹ã§JRæ¡œå³¶é§…ã¸", points: "è¥¿ã‚²ãƒ¼ãƒˆå‰ã®ãƒã‚¹ãƒ­ãƒ¼ã‚¿ãƒªãƒ¼ã‹ã‚‰ã€ãƒ¦ãƒ‹ãƒãƒ¼ã‚µãƒ«ãƒ»ã‚¹ã‚¿ã‚¸ã‚ªãƒ»ã‚¸ãƒ£ãƒ‘ãƒ³æ–¹é¢ã¸å‘ã‹ã†ã‚·ãƒ£ãƒˆãƒ«ãƒã‚¹ã«ä¹—è»Šã€‚ç´„15åˆ†ã®çŸ­ã„ãƒã‚¹æ—…ã§ã™ã€‚" },
  { startTime: "2025-08-13T09:15:00", title: "JRã‚†ã‚å’²ç·šã§ãƒ¦ãƒ‹ãƒãƒ¼ã‚µãƒ«ã‚·ãƒ†ã‚£é§…ã¸", points: "æ¡œå³¶é§…ã‹ã‚‰ä¸€é§…ã ã‘é›»è»Šã«ä¹—ã‚Šã¾ã™ã€‚ã™ãã«åˆ°ç€ï¼" },
  { startTime: "2025-08-13T09:25:00", title: "ã€ãƒŸãƒƒã‚·ãƒ§ãƒ³ï¼‘ã€‘ãƒãƒƒãƒ—ã‚³ãƒ¼ãƒ³ãƒ‘ãƒ‘ã§ã€Œå†’é™ºã®å‘³ã€ã‚’é¸ã¹ï¼", points: "å ´æ‰€ï¼šUCWã®3éšã€‚æœ9æ™‚ã‹ã‚‰å–¶æ¥­ã€‚32ç¨®é¡ã®ãƒ•ãƒ¬ãƒ¼ãƒãƒ¼ã‹ã‚‰ã€Œä»Šæ—¥ã®å†’é™ºã®å‘³ã€ã‚’é¸ã¶æ™‚é–“ã¯ã€æœ€é«˜ã®ã‚¹ã‚¿ãƒ¼ãƒˆã«ãªã‚Šã¾ã™ã€‚URL: https://www.popcornpapa.jp/" },
  { startTime: "2025-08-13T10:00:00", title: "ã€ãƒŸãƒƒã‚·ãƒ§ãƒ³ï¼’ã€‘UCWã‚’æ¢æ¤œï¼", points: "å ´æ‰€ï¼šUCWã®3éšã‚„4éšã®ã‚·ãƒ§ãƒƒãƒ—ã‚¨ãƒªã‚¢ã€‚ã¡ã‚‡ã†ã©10æ™‚ã«ã»ã¨ã‚“ã©ã®ã‚·ãƒ§ãƒƒãƒ—ãŒé–‹åº—ã€‚ã‚«ãƒ©ãƒ•ãƒ«ãªã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚°ãƒƒã‚ºã‚’çœºã‚ãŸã‚Šã—ã¦ã€ä¸‡åšã¸ã®æœŸå¾…æ„Ÿã‚’é«˜ã‚ã¾ã—ã‚‡ã†ã€‚" },
  { startTime: "2025-08-13T11:00:00", title: "ã€ãƒŸãƒƒã‚·ãƒ§ãƒ³ï¼“ã€‘TAKOPAã§å¤§é˜ªåç‰©ãŸã“ç„¼ãã‚’é£Ÿã¹æ¯”ã¹ï¼", points: "å ´æ‰€ï¼šUCWã®4éšã«ã‚ã‚‹ãŸã“ç„¼ãã®ãƒ•ãƒ¼ãƒ‰ãƒ†ãƒ¼ãƒãƒ‘ãƒ¼ã‚¯ã€ŒTAKOPAã€ã€‚11æ™‚é–‹åº—ã§æ··é›‘ã‚’é¿ã‘ã‚‰ã‚Œã¾ã™ã€‚é•ã†ãŠåº—ã®ãŸã“ç„¼ãã‚’å°‘ã—ãšã¤è²·ã£ã¦ã€è¦ªå­ã§å‘³ã‚’æ¯”ã¹ã£ã“ãŒãŠã™ã™ã‚ã€‚URL: https://ucw.jp/restaurant/takopa/" },
  { startTime: "2025-08-13T11:45:00", title: "æ±ºæˆ¦ã®åœ°ã¸ï¼ä¸‡åšä¼šå ´ã¸å¸°é‚„", points: "å†ã³JRã¨ã‚·ãƒ£ãƒˆãƒ«ãƒã‚¹ã‚’ä¹—ã‚Šç¶™ãã€ä¸‡åšè¥¿ã‚²ãƒ¼ãƒˆã¸æˆ»ã‚Šã¾ã™ã€‚12æ™‚ã®å…¥å ´æ™‚é–“ã«ã¡ã‚‡ã†ã©è‰¯ãåˆ°ç€ã§ãã‚‹ã€å®Œç’§ãªæ™‚é–“é…åˆ†ã§ã™ã€‚" },
  
  // ä¸‡åšä¼šå ´å†…
  { startTime: "2025-08-13T12:00:00", title: "ã€æœ€é‡è¦ã€‘å…¥å ´ï¼†å½“æ—¥äºˆç´„é›»æ’ƒä½œæˆ¦ï¼", points: "ã‚²ãƒ¼ãƒˆã®QRã‚³ãƒ¼ãƒ‰ã‚’ã‹ã–ã—ã¦å…¥å ´ï¼ãã®ç¬é–“ã‹ã‚‰10åˆ†å¾Œã€ã‚¹ãƒãƒ›ã§ã®å½“æ—¥äºˆç´„æˆ¦äº‰ãŒå§‹ã¾ã‚Šã¾ã™ã€‚æ­©ãã‚¹ãƒãƒ›ã«æ³¨æ„ã—ã¤ã¤ã€ã‚¬ãƒ³ãƒ€ãƒ ãƒ‘ãƒ“ãƒªã‚ªãƒ³ã®12:00æ ã‚’ç‹™ã„æ’ƒã¡ï¼" },
  { startTime: "2025-08-13T12:30:00", title: "ãƒŸãƒƒã‚·ãƒ§ãƒ³å¸ä»¤éƒ¨ï¼šæ¡ˆå†…æ‰€ã¸", points: "è¥¿ã‚²ãƒ¼ãƒˆè¿‘ãã®æ¡ˆå†…æ‰€ã¸ç›´è¡Œã€‚ã€Œå­ã©ã‚‚ãŒæ¥½ã—ã‚ã‚‹ã€ä»Šä¸€ç•ªç©ºã„ã¦ã„ã‚‹ãƒ‘ãƒ“ãƒªã‚ªãƒ³ã¯ï¼Ÿã€ã€Œã‚¯ã‚¦ã‚§ãƒ¼ãƒˆé¤¨ã®æ•´ç†åˆ¸ã¯é…ã£ã¦ã„ã¾ã™ã‹ï¼Ÿã€ãªã©ã€ç”ŸããŸæƒ…å ±ã‚’åé›†ã—ã¾ã™ã€‚" },
  { startTime: "2025-08-13T13:00:00", title: "ã€ä¸–ç•Œæ—…è¡Œã¸å‡ºç™ºï¼ã€‘äºˆç´„ä¸è¦ãƒ‘ãƒ“ãƒªã‚ªãƒ³å·¡ã‚Š", points: "æ¡ˆå†…æ‰€ã®æƒ…å ±ã‚’ã‚‚ã¨ã«ã€å¾…ã¡æ™‚é–“ã®å°‘ãªã„ãƒ‘ãƒ“ãƒªã‚ªãƒ³ã‹ã‚‰æ”»ç•¥ï¼å„ªå…ˆåº¦Sï¼šğŸ‡³ğŸ‡±ã‚ªãƒ©ãƒ³ãƒ€ã€ğŸ‡¨ğŸ‡­ã‚¹ã‚¤ã‚¹ã€ğŸ‡©ğŸ‡ªãƒ‰ã‚¤ãƒ„ å„ªå…ˆåº¦Aï¼šğŸ‡¦ğŸ‡ªUAEã€ğŸ‡¦ğŸ‡ºã‚ªãƒ¼ã‚¹ãƒˆãƒ©ãƒªã‚¢ã€ğŸ‡ºğŸ‡¸ã‚¢ãƒ¡ãƒªã‚« ç‰¹ã«ã‚ªãƒ©ãƒ³ãƒ€é¤¨ã®ã€Œã‚ªãƒ¼ãƒ–ã€ã‚’æŒã£ã¦é€²ã‚€ä½“é¨“ã¯ãŠå­æ§˜ã«å¤§äººæ°—ã€‚" },
  { startTime: "2025-08-13T14:00:00", title: "ä½œæˆ¦çš„ãƒ©ãƒ³ãƒã‚¿ã‚¤ãƒ ", points: "æ··é›‘ã®ãƒ”ãƒ¼ã‚¯ã‚’éããŸã“ã®æ™‚é–“ãŒç‹™ã„ç›®ã€‚æŒå‚ã—ãŸãŠã«ãã‚Šã‚„ãƒ‘ãƒ³ã‚’ã€ã‚¬ãƒ³ãƒ€ãƒ æ¨ªã®èŠç”Ÿåºƒå ´ãªã©ã§é£Ÿã¹ã‚‹ã®ãŒæœ€ã‚‚åŠ¹ç‡çš„ã€‚ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ã®å ´åˆã‚‚å¾…ã¡æ™‚é–“ãŒæ ¼æ®µã«çŸ­ããªã£ã¦ã„ã¾ã™ã€‚" },
  { startTime: "2025-08-13T15:00:00", title: "äºˆç´„æ¸ˆã¿ãƒŸãƒ¥ãƒ¼ã‚¸ã‚«ãƒ«é‘‘è³", points: "ãƒ‘ãƒ“ãƒªã‚ªãƒ³å·¡ã‚Šã®åˆé–“ã«ã€äºˆç´„ã—ãŸã‚¹ã‚¿ãƒ³ãƒ‰å¸­ã§ç´ æ™´ã‚‰ã—ã„ã‚·ãƒ§ãƒ¼ã‚’é‘‘è³ã€‚åº§ã£ã¦æ¥½ã—ã‚ã‚‹ã®ã§ã€æœ€é«˜ã®ä¼‘æ¯æ™‚é–“ã«ãªã‚Šã¾ã™ã€‚" },
  { startTime: "2025-08-13T16:00:00", title: "ä¼‘æ†©ï¼†ãƒ•ãƒªãƒ¼ã‚¿ã‚¤ãƒ ", points: "äººæ··ã¿ã«ç–²ã‚ŒãŸã‚‰ã€Œé™ã‘ã•ã®æ£®ã€ã§ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³ã€‚ãŠå­æ§˜ã®ä½“åŠ›ã‚’è€ƒãˆã€æ„å›³çš„ã«ä¼‘æ†©ã‚’å–ã‚Šã¾ã—ã‚‡ã†ã€‚ä¼šå ´å†…ã®ãƒ™ãƒ“ãƒ¼ã‚«ãƒ¼ã¯4æ­³ã¾ã§ãŒå¯¾è±¡ãªã®ã§ã€ã“ã¾ã‚ãªä¼‘æ†©ãŒä¸å¯æ¬ ã§ã™ã€‚" },
  
  // å¤œã®éƒ¨
  { startTime: "2025-08-13T19:30:00", title: "å¤œç©ºã‚’å½©ã‚‹ãƒ‰ãƒ­ãƒ¼ãƒ³ã‚·ãƒ§ãƒ¼ï¼ˆèŠ±ç«ï¼‰é‘‘è³", points: "ä¸€æ—¥ã®ç· ã‚ããã‚Šã«ã€å¤œç©ºã«æã‹ã‚Œã‚‹å…‰ã®ã‚¢ãƒ¼ãƒˆã‚’é‘‘è³ã€‚æ˜¼é–“ã¨ã¯å…¨ãé•ã†ã€å¹»æƒ³çš„ãªä¸‡åšã®å§¿ã‚’ç›®ã«ç„¼ãä»˜ã‘ã¾ã—ã‚‡ã†ã€‚æœ€é«˜ã®æ€ã„å‡ºã«ãªã‚‹ã“ã¨é–“é•ã„ãªã—ã€‚" },
  { startTime: "2025-08-13T20:30:00", title: "æ¢…ç”°ã¸ç§»å‹•é–‹å§‹", points: "æ„Ÿå‹•ã®ä½™éŸ»ã«æµ¸ã‚ŠãªãŒã‚‰ã€è¥¿ã‚²ãƒ¼ãƒˆã‹ã‚‰æ¢…ç”°ï¼ˆå¤§é˜ªé§…ï¼‰è¡Œãã®ã‚·ãƒ£ãƒˆãƒ«ãƒã‚¹ã«ä¹—è»Šã€‚æ–™é‡‘ã¯ã‹ã‹ã‚Šã¾ã™ãŒï¼ˆå¤§äºº2,000å††/å°äºº1,000å††ï¼‰ã€ä¹—ã‚Šæ›ãˆãªã—ã§åº§ã£ã¦å¸°ã‚Œã‚‹å¿«é©ã•ã¯è²´é‡ã€‚" },
  { startTime: "2025-08-13T21:15:00", title: "æ¢…ç”°ã§æœ€å¾Œã®æ™©é¤ï¼†ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥", points: "ãƒ¨ãƒ‰ãƒã‚·æ¢…ç”°ã‚¿ãƒ¯ãƒ¼å‘¨è¾ºã§å¤•é£Ÿã€‚å€‹å®¤ã®ã‚ã‚‹ã€Œé…’æˆ¿ã†ãŠã¾ã‚“ã€ãªã©ã¯ã€å‘¨ã‚Šã‚’æ°—ã«ã›ãšè¦ªå­ã§ã‚†ã£ãã‚Šé£Ÿäº‹ã‚’ã™ã‚‹ã®ã«æœ€é©ã€‚ãƒã‚¹ä¹—è»Šå‰ã«éŠ­æ¹¯ã‚„ã‚·ãƒ£ãƒ¯ãƒ¼æ–½è¨­ã§æ±—ã‚’æµã›ã‚‹ã¨å¿«é©ã€‚" },
  { startTime: "2025-08-13T22:15:00", title: "ãƒ¨ãƒ‰ãƒã‚·æ¢…ç”°ã‚¿ãƒ¯ãƒ¼å‰ãƒã‚¹ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã¸", points: "ä¹—ã‚Šé…ã‚Œãªã„ã‚ˆã†ã«ã€ä½™è£•ã‚’ã‚‚ã£ã¦ç§»å‹•ã—ã¾ã—ã‚‡ã†ã€‚ãŠåœŸç”£ã®æœ€çµ‚ãƒã‚§ãƒƒã‚¯ã‚‚å¿˜ã‚Œãšã«ã€‚" },
  { startTime: "2025-08-13T22:30:00", title: "å¤œè¡Œãƒã‚¹ä¹—è»Šãƒ»åƒè‘‰ã¸ï¼", points: "ãŸãã•ã‚“ã®æ€ã„å‡ºã‚’èƒ¸ã«ã€å¸°è·¯ã«ã¤ãã¾ã™ã€‚" },
  
  // 8æœˆ14æ—¥ï¼ˆæ°´ï¼‰
  { startTime: "2025-08-14T08:50:00", title: "è¥¿èˆ¹æ©‹é§… åˆ°ç€", points: "ç„¡äº‹åˆ°ç€ã§ã™ã€‚" }
];

export const SeedDatabaseFixed = () => {
  const [status, setStatus] = useState('å¾…æ©Ÿä¸­');
  const [isLoading, setIsLoading] = useState(false);

  const clearDatabase = async () => {
    setStatus('ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ã‚¯ãƒªã‚¢ä¸­...');
    setIsLoading(true);
    
    try {
      // æ—¢å­˜ã®ãƒ‡ãƒ¼ã‚¿ã‚’å…¨ã¦å–å¾—
      const result = await client.graphql({
        query: queries.listItineraries,
        variables: { limit: 1000 }
      }) as any;
      
      const items = result.data?.listItineraries?.items || [];
      
      // å…¨ã¦ã®ã‚¢ã‚¤ãƒ†ãƒ ã‚’å‰Šé™¤
      for (const item of items) {
        await client.graphql({
          query: mutations.deleteItinerary,
          variables: { input: { id: item.id } }
        });
      }
      
      setStatus(`${items.length}ä»¶ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚`);
    } catch (error: any) {
      console.error('Error clearing database:', error);
      setStatus(`ã‚¯ãƒªã‚¢ã‚¨ãƒ©ãƒ¼: ${error.message}`);
    } finally {
      setIsLoading(false);
    }
  };

  const seedDatabase = async () => {
    setStatus('ç™»éŒ²å‡¦ç†ã‚’é–‹å§‹ã—ã¾ã™...');
    setIsLoading(true);
    let count = 0;
    
    try {
      for (const item of itineraryData) {
        const input = {
          startTime: item.startTime,
          title: item.title,
          points: item.points,
          description: item.title,
        };
        
        await client.graphql({ 
          query: mutations.createItinerary, 
          variables: { input: input } 
        });
        
        count++;
        setStatus(`${count} / ${itineraryData.length} ä»¶ ç™»éŒ²å®Œäº†...`);
      }
      
      setStatus('ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã®ç™»éŒ²ãŒå®Œäº†ã—ã¾ã—ãŸï¼');
      
      // 3ç§’å¾Œã«ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰
      setTimeout(() => {
        window.location.reload();
      }, 3000);
      
    } catch (error: any) {
      console.error('ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¸ã®ç™»éŒ²ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ', error);
      console.error('Error details:', error.errors);
      setStatus(`ã‚¨ãƒ©ãƒ¼: ${error.message || error.errors?.[0]?.message || 'ãƒ‡ãƒ¼ã‚¿ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸ'}`);
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <div style={{ 
      padding: '20px', 
      background: 'white', 
      borderRadius: '10px', 
      margin: '20px',
      boxShadow: '0 2px 10px rgba(0,0,0,0.1)'
    }}>
      <h2>ğŸŒ æ—…è¡Œè¨ˆç”»ãƒ‡ãƒ¼ã‚¿ç™»éŒ²ãƒ„ãƒ¼ãƒ«</h2>
      <p>ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«æ—…è¡Œè¨ˆç”»ã‚’ç™»éŒ²ãƒ»ç®¡ç†ã—ã¾ã™ã€‚</p>
      
      <div style={{ display: 'flex', gap: '10px', marginTop: '10px' }}>
        <button 
          onClick={clearDatabase} 
          disabled={isLoading}
          style={{
            padding: '10px 20px',
            fontSize: '16px',
            background: isLoading ? '#ccc' : '#e74c3c',
            color: 'white',
            border: 'none',
            borderRadius: '5px',
            cursor: isLoading ? 'not-allowed' : 'pointer'
          }}
        >
          {isLoading ? 'å‡¦ç†ä¸­...' : 'ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ã‚¯ãƒªã‚¢'}
        </button>
        
        <button 
          onClick={seedDatabase} 
          disabled={isLoading}
          style={{
            padding: '10px 20px',
            fontSize: '16px',
            background: isLoading ? '#ccc' : '#667eea',
            color: 'white',
            border: 'none',
            borderRadius: '5px',
            cursor: isLoading ? 'not-allowed' : 'pointer'
          }}
        >
          {isLoading ? 'ç™»éŒ²ä¸­...' : 'æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ã‚’ç™»éŒ²'}
        </button>
      </div>
      
      <p style={{ marginTop: '15px', fontWeight: 'bold' }}>
        ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: {status}
      </p>
    </div>
  );
};