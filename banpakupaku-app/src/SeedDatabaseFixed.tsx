import React, { useState } from 'react';
import { generateClient } from 'aws-amplify/api';
import * as mutations from './graphql/mutations';
import * as queries from './graphql/queries';

const client = generateClient();

const itineraryData = [
  // 8æœˆ12æ—¥ï¼ˆæœˆï¼‰
  { startTime: "2025-08-12T21:30:00", title: "è¥¿èˆ¹æ©‹é§…å—å£ é«˜é€Ÿãƒã‚¹ä¹—ã‚Šå ´ é›†åˆ", points: "ãƒˆã‚¤ãƒ¬ã‚’æ¸ˆã¾ã›ã€é£²ã¿ç‰©ãªã©ã‚’æº–å‚™ã€‚ãƒã‚¹ã¯å®šåˆ»ã«å‡ºç™ºã—ã¾ã™ã€‚æ—©ã‚ã®è¡Œå‹•ã‚’å¿ƒãŒã‘ã¾ã—ã‚‡ã†ã€‚" },
  { startTime: "2025-08-12T22:10:00", title: "å¤œè¡Œãƒã‚¹ä¹—è»Šãƒ»å¤§é˜ªã¸å‡ºç™ºï¼", points: "å¤§é˜ªã§ã®å¤§å†’é™ºã‚’å¤¢è¦‹ã¦ã€ãŠã‚„ã™ã¿ãªã•ã„ã€‚ãƒªãƒ©ãƒƒã‚¯ã‚¹ã§ãã‚‹æœè£…ãŒãŠã™ã™ã‚ã§ã™ã€‚" },
  
  // 8æœˆ13æ—¥ï¼ˆç«ï¼‰ã€Hybrid Plan A: æ¡œå³¶é§…å‰é™è»Šã®å ´åˆã€‘
  { startTime: "2025-08-13T08:40:00", title: "ğŸšŒ æ¡œå³¶é§…å‰ï¼ˆãƒªãƒ¼ãƒ™ãƒ«ãƒ›ãƒ†ãƒ«å‰ï¼‰é™è»Š", points: "ã€Plan Aæœ€é«˜ã‚·ãƒŠãƒªã‚ªã€‘é‹è»¢æ‰‹ã•ã‚“ã®å¥½æ„ã«æ„Ÿè¬ï¼ç›®ã®å‰ãŒJRæ¡œå³¶é§…ã€‚æ™‚é–“ç¯€ç´„40åˆ†ã€è²»ç”¨ç¯€ç´„700å††ã€ä½“åŠ›æ¸©å­˜ï¼" },
  { startTime: "2025-08-13T08:45:00", title: "ğŸš¶ JRæ¡œå³¶é§…ã¸ç§»å‹•", points: "å¾’æ­©1åˆ†ã€ã‚¨ãƒ¬ãƒ™ãƒ¼ã‚¿ãƒ¼å®Œå‚™ã€‚æ”¹æœ­ã¾ã§ã™ãã§ã™ã€‚" },
  { startTime: "2025-08-13T08:50:00", title: "ğŸšƒ JRã‚†ã‚å’²ç·šä¹—è»Š", points: "ãƒ¦ãƒ‹ãƒãƒ¼ã‚µãƒ«ã‚·ãƒ†ã‚£é§…ã¾ã§1é§…2åˆ†ï¼ˆ180å††ï¼‰ã€‚æœã®ç©ºã„ã¦ã„ã‚‹æ™‚é–“å¸¯ã§ãƒ©ãƒƒã‚­ãƒ¼ï¼" },
  { startTime: "2025-08-13T09:00:00", title: "ğŸª UCWåˆ°ç€ãƒ»æ—©æœä½œæˆ¦é–‹å§‹", points: "3éšãƒ¡ã‚¤ãƒ³ã‚¨ãƒ³ãƒˆãƒ©ãƒ³ã‚¹ã‹ã‚‰å…¥å ´ã€‚ã¾ã äººãŒå°‘ãªã„é»„é‡‘ã‚¿ã‚¤ãƒ ï¼" },
  { startTime: "2025-08-13T09:05:00", title: "ğŸ¿ ãƒãƒƒãƒ—ã‚³ãƒ¼ãƒ³ãƒ‘ãƒ‘ï¼ˆ3éšï¼‰", points: "â­æœ9æ™‚é–‹åº—ã®è²´é‡ãªåº—ï¼32ç¨®é¡ã‹ã‚‰é¸ã¶æ¥½ã—ã•ã€‚ãŠã™ã™ã‚ï¼šã‚­ãƒ£ãƒ©ãƒ¡ãƒ«ã€ãƒãƒ¼ã‚ºã€æŠ¹èŒ¶å‘³" },
  { startTime: "2025-08-13T09:30:00", title: "ğŸª ãƒ­ãƒ¼ã‚½ãƒ³ã§é£²ã¿ç‰©è³¼å…¥", points: "ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³é–‹åº—å‰ã®æ°´åˆ†è£œçµ¦å¯¾ç­–ã€‚å­ä¾›ç”¨ã®ãŠèŒ¶ã‚‚å¿˜ã‚Œãšã«ã€‚" },
  { startTime: "2025-08-13T09:45:00", title: "ğŸ›ï¸ ãƒ¦ãƒ‹ãƒãƒ¼ã‚µãƒ«ãƒ»ã‚¹ã‚¿ã‚¸ã‚ªãƒ»ã‚¹ãƒˆã‚¢", points: "10æ™‚é–‹åº—ã¨åŒæ™‚ã«å…¥åº—ï¼ãƒŸãƒ‹ã‚ªãƒ³ã€ãƒãƒªã‚ªã‚°ãƒƒã‚ºã‚’ãƒã‚§ãƒƒã‚¯ã€‚æ··é›‘å‰ã®ç‰¹æ¨©ã€‚" },
  { startTime: "2025-08-13T10:15:00", title: "ğŸ“¸ å†™çœŸæ’®å½±ã‚¿ã‚¤ãƒ ", points: "ã‚¢ãƒ¡ãƒªã‚«ãƒ³ãªè¡—ä¸¦ã¿ã§è¨˜å¿µæ’®å½±ã€‚äººãŒå°‘ãªã„æœã®ç‰¹æ¨©ï¼ã‚¤ãƒ³ã‚¹ã‚¿æ˜ ãˆç¢ºå®Ÿã€‚" },
  { startTime: "2025-08-13T10:30:00", title: "ğŸ Little OSAKAï¼ˆ3éšï¼‰", points: "å¤§é˜ªåœŸç”£ã®ä¸‹è¦‹ï¼ˆãƒ“ãƒªã‚±ãƒ³ã•ã‚“ã€ãŸã“ç„¼ãã‚°ãƒƒã‚ºï¼‰ã€‚å¸°ã‚Šã«è²·ã†ã‚‚ã®ã‚’ãƒã‚§ãƒƒã‚¯ã€‚" },
  { startTime: "2025-08-13T10:50:00", title: "ğŸš» ãƒˆã‚¤ãƒ¬ä¼‘æ†©ãƒ»æº–å‚™", points: "TAKOPAé–‹åº—å‰ã®æœ€çµ‚æº–å‚™ã€‚æ‰‹ã‚’æ´—ã£ã¦ã€ãŸã“ç„¼ãã«å‚™ãˆã‚ˆã†ï¼" },
  { startTime: "2025-08-13T11:00:00", title: "ğŸ™ TAKOPAé–‹åº—ãƒ€ãƒƒã‚·ãƒ¥ï¼", points: "â­é–‹åº—ã¨åŒæ™‚ã«å…¥åº—ã§æ··é›‘å›é¿ï¼æ¨å¥¨ï¼šé“é “å €ããã‚‹ã€ç”²è³€æµã®2åº—èˆ—åˆ¶è¦‡ã€‚ç†±ã€…æ³¨æ„ï¼" },
  { startTime: "2025-08-13T11:30:00", title: "ğŸ´ ãŸã“ç„¼ãæº€å–«", points: "å†·ã¾ã—æ™‚é–“å«ã‚€ã€ãŠå­æ§˜ã¯4å€‹ã‚»ãƒƒãƒˆãŒãƒ™ã‚¹ãƒˆã€‚ãƒ•ãƒ¼ãƒ‰ã‚³ãƒ¼ãƒˆã§ã‚†ã£ãã‚Šã€‚" },
  { startTime: "2025-08-13T11:45:00", title: "ğŸšƒ ä¸‡åšä¼šå ´ã¸å‡ºç™º", points: "JRã§æ¡œå³¶é§…â†’ã‚·ãƒ£ãƒˆãƒ«ãƒã‚¹ã§è¥¿ã‚²ãƒ¼ãƒˆï¼ˆ12:00,12:15ç™ºï¼‰https://www.expo2025.or.jp/access/" },
  
  // ä¸‡åšä¼šå ´å†…
  { startTime: "2025-08-13T12:00:00", title: "ğŸŠ ä¸‡åšè¥¿ã‚²ãƒ¼ãƒˆåˆ°ç€ãƒ»å…¥å ´ï¼", points: "QRã‚³ãƒ¼ãƒ‰ã§ç´ æ—©ãå…¥å ´ã€‚ã„ã‚ˆã„ã‚ˆä¸‡åšã®å†’é™ºé–‹å§‹ï¼" },
  { startTime: "2025-08-13T12:10:00", title: "ğŸ“± å½“æ—¥äºˆç´„ãƒãƒˆãƒ«", points: "âš¡ã‚¬ãƒ³ãƒ€ãƒ ãƒ‘ãƒ“ãƒªã‚ªãƒ³12æ™‚æ ã«æŒ‘æˆ¦ï¼äºˆç´„ã‚µã‚¤ãƒˆã«äº‹å‰ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãŠãã“ã¨ã€‚å–ã‚Œãªãã¦ã‚‚å¤§ä¸ˆå¤«ï¼" },
  { startTime: "2025-08-13T12:30:00", title: "ğŸ—ºï¸ æ¡ˆå†…æ‰€ã§æƒ…å ±åé›†", points: "ã€Œ6æ­³ãŒæ¥½ã—ã‚ã‚‹ç©ºã„ã¦ã„ã‚‹ãƒ‘ãƒ“ãƒªã‚ªãƒ³ã€ã‚’èãã€‚ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ··é›‘æƒ…å ±ã‚’ã‚²ãƒƒãƒˆï¼" },
  { startTime: "2025-08-13T12:45:00", title: "ğŸ™ è»½é£Ÿã‚¿ã‚¤ãƒ ", points: "æ··é›‘å‰ã«ãŠæ˜¼ã”ã¯ã‚“ï¼ˆãŠã«ãã‚Šç­‰ï¼‰ã€‚ã‚¬ãƒ³ãƒ€ãƒ æ¨ªã®èŠç”Ÿåºƒå ´ãŒãŠã™ã™ã‚ã€‚" },
  { startTime: "2025-08-13T13:00:00", title: "ğŸŒ ãƒ‘ãƒ“ãƒªã‚ªãƒ³å·¡ã‚Šé–‹å§‹", points: "äºˆç´„ä¸è¦ãƒ™ã‚¹ãƒˆ5ï¼šğŸ‡³ğŸ‡±ã‚ªãƒ©ãƒ³ãƒ€ï¼ˆã‚ªãƒ¼ãƒ–ä½“é¨“ï¼‰ã€ğŸ‡¨ğŸ‡­ã‚¹ã‚¤ã‚¹ï¼ˆçƒä½“ã‚·ã‚¢ã‚¿ãƒ¼ï¼‰ã€ğŸ‡©ğŸ‡ªãƒ‰ã‚¤ãƒ„ï¼ˆå¾ªç’°éƒ½å¸‚ï¼‰ã€ğŸ‡¦ğŸ‡ºã‚ªãƒ¼ã‚¹ãƒˆãƒ©ãƒªã‚¢ï¼ˆå‹•ç‰©ï¼‰ã€ğŸ‡ºğŸ‡¸ã‚¢ãƒ¡ãƒªã‚«ï¼ˆå®‡å®™ï¼‰" },
  { startTime: "2025-08-13T15:00:00", title: "å„ãƒ‘ãƒ“ãƒªã‚ªãƒ³æ”»ç•¥ä¸­", points: "å„ãƒ‘ãƒ“ãƒªã‚ªãƒ³30-45åˆ†ï¼ˆå¾…ã¡æ™‚é–“å«ã‚€ï¼‰ã€ç§»å‹•10-15åˆ†ã€30åˆ†ã”ã¨ã«5åˆ†ä¼‘æ†©ã‚’å¿˜ã‚Œãšã«ï¼" },
  { startTime: "2025-08-13T17:00:00", title: "ğŸ­ äºˆç´„æ¸ˆã¿ãƒŸãƒ¥ãƒ¼ã‚¸ã‚«ãƒ«é‘‘è³", points: "åº§ã£ã¦ä¼‘æ†©ã§ãã‚‹è²´é‡ãªæ™‚é–“ã€‚ãŠå­æ§˜ã‚‚æ¥½ã—ã‚ã‚‹å†…å®¹ã§å¤§æº€è¶³ï¼" },
  { startTime: "2025-08-13T18:00:00", title: "ğŸœ å¤•é£Ÿ", points: "ãƒ•ãƒ¼ãƒ‰ã‚³ãƒ¼ãƒˆã§å¤§é˜ªåç‰©ã‚’ã€‚æ··é›‘ãƒ”ãƒ¼ã‚¯ã‚’éãã¦ã„ã‚‹ã®ã§æ¯”è¼ƒçš„ã‚¹ãƒ ãƒ¼ã‚ºã€‚" },
  { startTime: "2025-08-13T18:45:00", title: "ğŸŒ³ é™ã‘ã•ã®æ£®ã§ä¼‘æ†©", points: "å¤œã®ã‚·ãƒ§ãƒ¼å‰ã®ã‚¨ãƒãƒ«ã‚®ãƒ¼ãƒãƒ£ãƒ¼ã‚¸ã€‚ãŠå­æ§˜ã®ä½“åŠ›å›å¾©ã‚¿ã‚¤ãƒ ã€‚" },
  { startTime: "2025-08-13T19:15:00", title: "ğŸ† ãƒ‰ãƒ­ãƒ¼ãƒ³ã‚·ãƒ§ãƒ¼è¦³è¦§å ´æ‰€ç¢ºä¿", points: "è¥¿ã‚²ãƒ¼ãƒˆä»˜è¿‘ãŒãŠã™ã™ã‚ã€‚ãƒ¬ã‚¸ãƒ£ãƒ¼ã‚·ãƒ¼ãƒˆå¿…é ˆï¼" },
  
  // å¤œã®éƒ¨
  { startTime: "2025-08-13T19:30:00", title: "ğŸ† ãƒ‰ãƒ­ãƒ¼ãƒ³ã‚·ãƒ§ãƒ¼é‘‘è³", points: "20ä¸‡æ©Ÿã®ãƒ‰ãƒ­ãƒ¼ãƒ³ãŒæãå…‰ã®ã‚¢ãƒ¼ãƒˆï¼æ˜¼é–“ã¨ã¯å…¨ãé•ã†å¹»æƒ³çš„ãªä¸‡åšã€‚æœ€é«˜ã®æ€ã„å‡ºï¼" },
  { startTime: "2025-08-13T20:00:00", title: "ğŸ“¸ å¤œã®ä¸‡åšæ’®å½±", points: "ãƒ©ã‚¤ãƒˆã‚¢ãƒƒãƒ—ã•ã‚ŒãŸä¼šå ´ã¯åˆ¥ä¸–ç•Œã€‚è¨˜å¿µæ’®å½±ã‚’å¿˜ã‚Œãšã«ï¼" },
  { startTime: "2025-08-13T20:30:00", title: "ğŸšŒ è¥¿ã‚²ãƒ¼ãƒˆã‹ã‚‰é€€å ´æº–å‚™", points: "æ··é›‘å‰ã«ç§»å‹•é–‹å§‹ã€‚ãŠå­æ§˜ã¨æ‰‹ã‚’ã¤ãªã„ã§è¿·å­é˜²æ­¢ã€‚" },
  { startTime: "2025-08-13T20:45:00", title: "ğŸšŒ æ¢…ç”°è¡Œãã‚·ãƒ£ãƒˆãƒ«ãƒã‚¹ä¹—è»Š", points: "ç›´é€š40åˆ†ã§æ¢…ç”°ã¸ã€‚åº§ã£ã¦å¸°ã‚Œã‚‹å¿«é©ã•ã€‚https://www.expo2025.or.jp/access/" },
  { startTime: "2025-08-13T21:30:00", title: "ğŸ™ï¸ æ¢…ç”°åˆ°ç€", points: "ãƒ¨ãƒ‰ãƒã‚·æ¢…ç”°ã‚¿ãƒ¯ãƒ¼ä»˜è¿‘ã«åˆ°ç€ã€‚ã“ã“ã‹ã‚‰ãŒæœ€å¾Œã®æº–å‚™ã€‚" },
  { startTime: "2025-08-13T21:45:00", title: "ğŸª ã‚³ãƒ³ãƒ“ãƒ‹ã§æœ€çµ‚æº–å‚™", points: "é£²ã¿ç‰©ã€è»½é£Ÿè³¼å…¥ã€‚ãƒˆã‚¤ãƒ¬ã‚‚æ¸ˆã¾ã›ã¦ãŠãã¾ã—ã‚‡ã†ã€‚" },
  { startTime: "2025-08-13T22:15:00", title: "ğŸšŒ ãƒã‚¹ä¹—ã‚Šå ´ã¸ç§»å‹•", points: "ä½™è£•ã‚’æŒã£ã¦ç§»å‹•ã€‚ãŠåœŸç”£ã®æœ€çµ‚ãƒã‚§ãƒƒã‚¯ï¼" },
  { startTime: "2025-08-13T22:30:00", title: "ğŸšŒ å¤œè¡Œãƒã‚¹ä¹—è»Šãƒ»åƒè‘‰ã¸ï¼", points: "ãŸãã•ã‚“ã®æ€ã„å‡ºã‚’èƒ¸ã«å¸°è·¯ã¸ã€‚ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼" },
  
  // 8æœˆ14æ—¥ï¼ˆæ°´ï¼‰
  { startTime: "2025-08-14T08:50:00", title: "è¥¿èˆ¹æ©‹é§… åˆ°ç€", points: "ç„¡äº‹åˆ°ç€ï¼æœ€é«˜ã®å†’é™ºã§ã—ãŸã€‚å®¶ã«å¸°ã‚‹ã¾ã§ãŒæ—…è¡Œã§ã™ã€‚" }
];

export const SeedDatabaseFixed = () => {
  const [status, setStatus] = useState('å¾…æ©Ÿä¸­');
  const [isLoading, setIsLoading] = useState(false);

  const clearDatabase = async () => {
    setStatus('ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ã‚¯ãƒªã‚¢ä¸­...');
    setIsLoading(true);
    
    try {
      // æ—¢å­˜ã®ãƒ‡ãƒ¼ã‚¿ã‚’å…¨ã¦å–å¾—
      const result = await client.graphql({
        query: queries.listItineraries,
        variables: { limit: 1000 }
      }) as any;
      
      const items = result.data?.listItineraries?.items || [];
      
      // å…¨ã¦ã®ã‚¢ã‚¤ãƒ†ãƒ ã‚’å‰Šé™¤
      for (const item of items) {
        await client.graphql({
          query: mutations.deleteItinerary,
          variables: { input: { id: item.id } }
        });
      }
      
      setStatus(`${items.length}ä»¶ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚`);
    } catch (error: any) {
      console.error('Error clearing database:', error);
      setStatus(`ã‚¯ãƒªã‚¢ã‚¨ãƒ©ãƒ¼: ${error.message}`);
    } finally {
      setIsLoading(false);
    }
  };

  const seedDatabase = async () => {
    setStatus('ç™»éŒ²å‡¦ç†ã‚’é–‹å§‹ã—ã¾ã™...');
    setIsLoading(true);
    let count = 0;
    
    try {
      for (const item of itineraryData) {
        const input = {
          startTime: item.startTime,
          title: item.title,
          points: item.points,
          description: item.title,
        };
        
        await client.graphql({ 
          query: mutations.createItinerary, 
          variables: { input: input } 
        });
        
        count++;
        setStatus(`${count} / ${itineraryData.length} ä»¶ ç™»éŒ²å®Œäº†...`);
      }
      
      setStatus('ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã®ç™»éŒ²ãŒå®Œäº†ã—ã¾ã—ãŸï¼');
      
      // 3ç§’å¾Œã«ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰
      setTimeout(() => {
        window.location.reload();
      }, 3000);
      
    } catch (error: any) {
      console.error('ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¸ã®ç™»éŒ²ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ', error);
      console.error('Error details:', error.errors);
      setStatus(`ã‚¨ãƒ©ãƒ¼: ${error.message || error.errors?.[0]?.message || 'ãƒ‡ãƒ¼ã‚¿ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸ'}`);
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <div style={{ 
      padding: '20px', 
      background: 'white', 
      borderRadius: '10px', 
      margin: '20px',
      boxShadow: '0 2px 10px rgba(0,0,0,0.1)'
    }}>
      <h2>ğŸŒ æ—…è¡Œè¨ˆç”»ãƒ‡ãƒ¼ã‚¿ç™»éŒ²ãƒ„ãƒ¼ãƒ«</h2>
      <p>ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«æ—…è¡Œè¨ˆç”»ã‚’ç™»éŒ²ãƒ»ç®¡ç†ã—ã¾ã™ã€‚</p>
      
      <div style={{ display: 'flex', gap: '10px', marginTop: '10px' }}>
        <button 
          onClick={clearDatabase} 
          disabled={isLoading}
          style={{
            padding: '10px 20px',
            fontSize: '16px',
            background: isLoading ? '#ccc' : '#e74c3c',
            color: 'white',
            border: 'none',
            borderRadius: '5px',
            cursor: isLoading ? 'not-allowed' : 'pointer'
          }}
        >
          {isLoading ? 'å‡¦ç†ä¸­...' : 'ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ã‚¯ãƒªã‚¢'}
        </button>
        
        <button 
          onClick={seedDatabase} 
          disabled={isLoading}
          style={{
            padding: '10px 20px',
            fontSize: '16px',
            background: isLoading ? '#ccc' : '#667eea',
            color: 'white',
            border: 'none',
            borderRadius: '5px',
            cursor: isLoading ? 'not-allowed' : 'pointer'
          }}
        >
          {isLoading ? 'ç™»éŒ²ä¸­...' : 'æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ã‚’ç™»éŒ²'}
        </button>
      </div>
      
      <p style={{ marginTop: '15px', fontWeight: 'bold' }}>
        ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: {status}
      </p>
    </div>
  );
};